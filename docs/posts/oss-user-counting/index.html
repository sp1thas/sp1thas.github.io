<!doctype html><html lang=en dir=auto>
<head><meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="IE=edge">
<meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no">
<meta name=robots content="index, follow">
<title>OSS: Estimate and monitor the number of active users using Github Actions | Panagiotis Simakis</title>
<meta name=keywords content="count,count-installations,github-actions,open-source,oss">
<meta name=description content="Track and monitor the total number of users using Github Actions.">
<meta name=author content="Panagiotis Simakis">
<link rel=canonical href=https://simakis.me/posts/oss-user-counting/>
<link crossorigin=anonymous href=/assets/css/stylesheet.min.48a18943c2fc15c38a372b8dde1f5e5dc0bc64fa6cb90f5a817d2f8c76b7f3ae.css integrity="sha256-SKGJQ8L8FcOKNyuN3h9eXcC8ZPpsuQ9agX0vjHa3864=" rel="preload stylesheet" as=style>
<script defer crossorigin=anonymous src=/assets/js/highlight.min.7680afc38aa6b15ddf158a4f3780b7b1f7dde7e91d26f073e6229bb7a0793c92.js integrity="sha256-doCvw4qmsV3fFYpPN4C3sffd5+kdJvBz5iKbt6B5PJI=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://simakis.me/favicons/favicon.ico>
<link rel=icon type=image/png sizes=16x16 href=https://simakis.me/favicons/favicon-16x16.png>
<link rel=icon type=image/png sizes=32x32 href=https://simakis.me/favicons/favicon-32x32.png>
<link rel=apple-touch-icon href=https://simakis.me/favicons/apple-touch-icon.png>
<link rel=mask-icon href=https://simakis.me/safari-pinned-tab.svg>
<meta name=theme-color content="#2e2e33">
<meta name=msapplication-TileColor content="#2e2e33">
<noscript>
<style>#theme-toggle,.top-link{display:none}</style>
<style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style>
</noscript><script async defer data-website-id=6b836b1b-f562-47d0-a681-7a36d59c761b src=https://analytics.simakis.me/umami.js></script>
<link rel=stylesheet href=https://simakis.me/custom.css>
<meta property="og:title" content="OSS: Estimate and monitor the number of active users using Github Actions">
<meta property="og:description" content="Track and monitor the total number of users using Github Actions.">
<meta property="og:type" content="article">
<meta property="og:url" content="https://simakis.me/posts/oss-user-counting/">
<meta property="og:image" content="https://simakis.me/images/post-covers/counting.jpg"><meta property="article:section" content="posts">
<meta property="article:published_time" content="2022-02-20T15:24:09+02:00">
<meta property="article:modified_time" content="2022-02-20T15:24:09+02:00">
<meta name=twitter:card content="summary_large_image">
<meta name=twitter:image content="https://simakis.me/images/post-covers/counting.jpg">
<meta name=twitter:title content="OSS: Estimate and monitor the number of active users using Github Actions">
<meta name=twitter:description content="Track and monitor the total number of users using Github Actions.">
<script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://simakis.me/posts/"},{"@type":"ListItem","position":2,"name":"OSS: Estimate and monitor the number of active users using Github Actions","item":"https://simakis.me/posts/oss-user-counting/"}]}</script>
<script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"OSS: Estimate and monitor the number of active users using Github Actions","name":"OSS: Estimate and monitor the number of active users using Github Actions","description":"Track and monitor the total number of users using Github Actions.","keywords":["count","count-installations","github-actions","open-source","oss"],"articleBody":"Context A beta version of your awesome open-source software has been released. Great news so far. Except from introducing new features, fixing bugs and answering users' questions, it‚Äôs really important to have an estimation of the total number of users. In case you are not the only user of your OSS, it‚Äôs significant to monitor the active users for the following reasons:\n Motivation. Knowing that people are using you software will motivate you to keep maintaining and improving your project. Trustworthy software. Spreading the total number of active users indicates that your OSS is trustworthy.  So, this article is going to present a way to count active users and installations using Github Actions.\nNumerous package distributors Nowadays, there are numerous ways to distribute your OSS. Snapcraft and Flatpak are two of the most known package management tools. Have in mind that you always have to provide the option to ‚ÄúBuild from source‚Äù to keep your geek users happy too. In a nutshell, you have to provide various installation methods, therefore, you have to summarize active users from more than one sources.\nCount installations So, let‚Äôs dig into how to count installations and active users for each installation method.\nKickstart script A common way to distribute your OSS is by providing a kickstart shell script, the purpose of this script is to download, build and install the software locally. In the case of dropboxignore, there is a kickstart script, and the installation instructions look like:\n   Method Command     curl sudo sh -c ‚Äú$(curl -fsSL https://rb.gy/12plgs)\" c   wget sudo sh -c ‚Äú$(wget -qO- https://rb.gy/12plgs)\" w    as you can see, I‚Äôm using and extra parameter at the end of each command in order to specify which lib was used to download the script (via wget or curl)\nInside the kickstart file, when installation is completed, I‚Äôm making few HTTP requests in order to count the installation process that just finished:\nINSTALL_COUNT_URL=\"https://api.countapi.xyz/hit/dropboxignore.simakis.me\" if [ \"$0\" == c ]; then curl -s --request GET --url \"${INSTALL_COUNT_URL}/wget\"  /dev/null curl -s --request GET --url \"${INSTALL_COUNT_URL}/total\"  /dev/null elif [ \"$0\" == w ]; then wget -q \"${INSTALL_COUNT_URL}/curl\" -O /dev/null 2 /dev/null wget -q \"${INSTALL_COUNT_URL}/total\" -O /dev/null 2 /dev/null fi CountAPI is a simple way to store stateful information like the total number of installations. You have to create a namespace for your project, and after that, make an GET /hit/:namespace?/:key to increase total installations by one.\nFinally, you can get the total number of installations by making an GET /info/:namespace?/:key. In case of dropboxignore:\n$ MANUAL_INSTALLATIONS=$(curl -s https://api.countapi.xyz/info/dropboxignore.simakis.me/total | jq -r .value) $ echo $MANUAL_INSTALLATIONS 12 At the time of writing dropboxignore has been installed 12 times using the kickstart.\nSnapcraft Another common way to distribute your software is as a snap. Snapcraft provides a nice monitoring dashboard:\nBut in our case, this is not enough, we have to extract the raw data programmatically. For this reason we are going to use Snapcraft CLI and Snapcraft Action\nTo get snapcraft metrics, you have to export a credential file and to create a github secret using the content of the exported file:\n$ snapcraft login $ snapcraft export-login exported In order to get the current total number of active user, you have to use the snapcraft metric command:\n$ SNAP_INSTALLATIONS=$( \\  snapcraft metrics dropboxignore --name installed_base_by_channel \\  --start \"$(date +\"%Y-%m-%d\" --date=\"yesterday\")\" \\  --end \"$(date +\"%Y-%m-%d\" --date=\"yesterday\")\" \\  --format=json \\  | jq '.series[].values[]' \\  | awk '{s+=$1} END {printf \"%.0f\\n\", s}' \\ ) $ echo $SNAP_INSTALLATIONS 118 So, 118 users have installed dropboxignore using snap.\nSummarize The easy part is to summarize user from different sources:\n$ TOTAL_INSTALLATIONS=$((MANUAL_INSTALLATIONS + SNAP_INSTALLATIONS)) $ echo $TOTAL_INSTALLATIONS 130 130 users. I‚Äôm already boosted morally ü§£.\nAutomate the boring staff using Github Actions Finally, given that we retrieved the necessary information programmatically, we are going to create a nightly job to store active users. The wiki of the repo should be enabled, so, we will use the wiki to store the statistics.\nJSON_BADGE_STRING=$(cat {\"schemaVersion\": 1, \"label\": \"installations\", \"message\": \"$TOTAL_INSTALLATIONS\"} END ) JSON_FULL_STRING=$(cat {\"manual-installations\": \"$MANUAL_INSTALLATIONS\", \"snap-installations\": \"$SNAP_INSTALLATIONS\", \"total-installations\": \"$TOTAL_INSTALLATIONS\"} END ) FILENAME=\"$(date +\"%Y-%m-%d\" --date=\"yesterday\")-stats.json\" echo \"$JSON_BADGE_STRING\"  latest-stats.json echo \"$JSON_FULL_STRING\"  \"$FILENAME\" git add latest-stats.json git add \"$FILENAME\" if ! git diff --staged --exit-code then git config --global user.email \"coverage-comment-action\" git config --global user.name \"Coverage Comment Action\" git commit -m \"$(date +\"%Y-%m-%d\" --date=\"yesterday\")stats\" git push -u origin else echo \"No change detected, skipping.\" fi Badges everywhere There is always space for one more badge with the total number of Cronjob using Github Actions The number of active users is updated every night using the following job:\nname: Nightly stats on: schedule: - cron: \"1 1 * * *\" workflow_dispatch: jobs: stats: runs-on: ubuntu-latest steps: - name: Install Snapcraft uses: samuelmeuli/action-snapcraft@v1 with: snapcraft_token: ${{ secrets.SNAPCRAFT_LOGIN_FILE }} - name: Install os dependencies run: sudo apt update \u0026\u0026 sudo apt install curl jq git - name: Create stats file run: sh -c \"$(curl -fsSL https://raw.githubusercontent.com/sp1thas/dropboxignore/master/utils/stats.sh)\" '${{ secrets.GITHUB_TOKEN }}' Next steps  Count manual uninstalls. Count flatpak installations.  References  sp1thas/dropboxignore dropboxignore/utils/stats.sh dropboxignore/.github/workflows/stats.yml Snapcraft Action Snapcraft CountAPI  ","wordCount":"838","inLanguage":"en","image":"https://simakis.me/images/post-covers/counting.jpg","datePublished":"2022-02-20T15:24:09+02:00","dateModified":"2022-02-20T15:24:09+02:00","author":{"@type":"Person","name":"Panagiotis Simakis"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://simakis.me/posts/oss-user-counting/"},"publisher":{"@type":"Organization","name":"Panagiotis Simakis","logo":{"@type":"ImageObject","url":"https://simakis.me/favicons/favicon.ico"}}}</script>
</head>
<body id=top>
<script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add('dark'):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove('dark'):window.matchMedia('(prefers-color-scheme: dark)').matches&&document.body.classList.add('dark')</script>
<header class=header>
<nav class=nav>
<div class=logo>
<a href=https://simakis.me/ accesskey=h title="Panagiotis Simakis (Alt + H)">Panagiotis Simakis</a>
<span class=logo-switches>
<button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg>
</button>
</span>
</div>
<ul id=menu>
<li>
<a href=https://simakis.me/posts title=Posts>
<span>Posts</span>
</a>
</li>
<li>
<a href=https://simakis.me/cv title=CV>
<span>CV</span>
</a>
</li>
<li>
<a href=https://simakis.me/contributions/ title=Contributions>
<span>Contributions</span>
</a>
</li>
<li>
<a href=https://simakis.me/search/ title="Search (Alt + /)" accesskey=/>
<span>Search</span>
</a>
</li>
<li>
<a href=https://simakis.me/contact/ title=Contact>
<span>Contact</span>
</a>
</li>
</ul>
</nav>
</header>
<main class=main>
<article class=post-single>
<header class=post-header>
<div class=breadcrumbs><a href=https://simakis.me/>Home</a>&nbsp;¬ª&nbsp;<a href=https://simakis.me/posts/>Posts</a></div>
<h1 class=post-title>
OSS: Estimate and monitor the number of active users using Github Actions
</h1>
<div class=post-description>
Track and monitor the total number of users using Github Actions.
</div>
<div class=post-meta><span title="2022-02-20 15:24:09 +0200 EET">February 20, 2022</span>&nbsp;¬∑&nbsp;4 min&nbsp;¬∑&nbsp;Panagiotis Simakis
</div>
</header>
<figure class=entry-cover><img loading=lazy src=https://simakis.me/images/post-covers/counting.jpg alt=counting>
<p>Photo by <a href="https://www.pexels.com/@padrinan?utm_content=attributionCopyText&utm_medium=referral&utm_source=pexels">Miguel √Å. Padri√±√°n</a> from <a href="https://www.pexels.com/photo/5-strike-symbol-1010973/?utm_content=attributionCopyText&utm_medium=referral&utm_source=pexels">Pexels</a></p>
</figure><div class=toc>
<details>
<summary accesskey=c title="(Alt + C)">
<span class=details>Table of Contents</span>
</summary>
<div class=inner><ul>
<li>
<a href=#context aria-label=Context>Context</a></li>
<li>
<a href=#numerous-package-distributors aria-label="Numerous package distributors">Numerous package distributors</a></li>
<li>
<a href=#count-installations aria-label="Count installations">Count installations</a><ul>
<li>
<a href=#kickstart-script aria-label="Kickstart script">Kickstart script</a></li>
<li>
<a href=#snapcraft aria-label=Snapcraft>Snapcraft</a></li></ul>
</li>
<li>
<a href=#summarize aria-label=Summarize>Summarize</a></li>
<li>
<a href=#automate-the-boring-staff-using-github-actions aria-label="Automate the boring staff using Github Actions">Automate the boring staff using Github Actions</a></li>
<li>
<a href=#badges-everywhere aria-label="Badges everywhere">Badges everywhere</a></li>
<li>
<a href=#cronjob-using-github-actions aria-label="Cronjob using Github Actions">Cronjob using Github Actions</a></li>
<li>
<a href=#next-steps aria-label="Next steps">Next steps</a></li>
<li>
<a href=#references aria-label=References>References</a>
</li>
</ul>
</div>
</details>
</div>
<div class=post-content><h2 id=context>Context<a hidden class=anchor aria-hidden=true href=#context>#</a></h2>
<p>A beta version of your awesome open-source software has been released. Great news so far. Except from introducing new features, fixing bugs and answering users' questions, it&rsquo;s really important to have an estimation of the total number of users. In case you are not the only user of your OSS, it&rsquo;s significant to monitor the active users for the following reasons:</p>
<ol>
<li><strong>Motivation</strong>. Knowing that people are using you software will motivate you to keep maintaining and improving your project.</li>
<li><strong>Trustworthy software</strong>. Spreading the total number of active users indicates that your OSS is trustworthy.</li>
</ol>
<p>So, this article is going to present a way to count active users and installations using <a href=https://github.com/features/actions>Github Actions</a>.</p>
<h2 id=numerous-package-distributors>Numerous package distributors<a hidden class=anchor aria-hidden=true href=#numerous-package-distributors>#</a></h2>
<p>Nowadays, there are numerous ways to distribute your OSS. Snapcraft and Flatpak are two of the most known package management tools. Have in mind that you always have to provide the option to &ldquo;Build from source&rdquo; to keep your geek users happy too. In a nutshell, you have to provide various installation methods, therefore, you have to summarize active users from more than one sources.</p>
<h2 id=count-installations>Count installations<a hidden class=anchor aria-hidden=true href=#count-installations>#</a></h2>
<p>So, let&rsquo;s dig into how to count installations and active users for each installation method.</p>
<h3 id=kickstart-script>Kickstart script<a hidden class=anchor aria-hidden=true href=#kickstart-script>#</a></h3>
<p>A common way to distribute your OSS is by providing a kickstart shell script, the purpose of this script is to download, build and install the software locally. In the case of <code>dropboxignore</code>, there is a kickstart script, and the installation instructions look like:</p>
<table>
<thead>
<tr>
<th>Method</th>
<th>Command</th>
</tr>
</thead>
<tbody>
<tr>
<td>curl</td>
<td><code>sudo sh -c &ldquo;$(curl -fsSL <a href=https://rb.gy/12plgs)%22>https://rb.gy/12plgs)"</a> c</code></td>
</tr>
<tr>
<td>wget</td>
<td><code>sudo sh -c &ldquo;$(wget -qO- <a href=https://rb.gy/12plgs)%22>https://rb.gy/12plgs)"</a> w</code></td>
</tr>
</tbody>
</table>
<p>as you can see, I&rsquo;m using and extra parameter at the end of each command in order to specify which lib was used to download the script (via <code>wget</code> or <code>curl</code>)</p>
<p>Inside the kickstart file, when installation is completed, I&rsquo;m making few HTTP requests in order to count the installation process that just finished:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>INSTALL_COUNT_URL<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;https://api.countapi.xyz/hit/dropboxignore.simakis.me&#34;</span>

<span style=color:#66d9ef>if</span> <span style=color:#f92672>[</span> <span style=color:#e6db74>&#34;</span>$0<span style=color:#e6db74>&#34;</span> <span style=color:#f92672>==</span> c <span style=color:#f92672>]</span>; <span style=color:#66d9ef>then</span>
  curl -s --request GET --url <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>${</span>INSTALL_COUNT_URL<span style=color:#e6db74>}</span><span style=color:#e6db74>/wget&#34;</span> &gt; /dev/null
  curl -s --request GET --url <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>${</span>INSTALL_COUNT_URL<span style=color:#e6db74>}</span><span style=color:#e6db74>/total&#34;</span> &gt; /dev/null
<span style=color:#66d9ef>elif</span> <span style=color:#f92672>[</span> <span style=color:#e6db74>&#34;</span>$0<span style=color:#e6db74>&#34;</span> <span style=color:#f92672>==</span> w <span style=color:#f92672>]</span>; <span style=color:#66d9ef>then</span>
  wget -q <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>${</span>INSTALL_COUNT_URL<span style=color:#e6db74>}</span><span style=color:#e6db74>/curl&#34;</span> -O /dev/null 2&gt; /dev/null
  wget -q <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>${</span>INSTALL_COUNT_URL<span style=color:#e6db74>}</span><span style=color:#e6db74>/total&#34;</span> -O /dev/null 2&gt; /dev/null
<span style=color:#66d9ef>fi</span>
</code></pre></div><p><a href=https://countapi.xyz/>CountAPI</a> is a simple way to store stateful information like the total number of installations. You have to create a namespace for your project, and after that, make an <code>GET /hit/:namespace?/:key</code> to increase total installations by one.</p>
<p>Finally, you can get the total number of installations by making an <code>GET /info/:namespace?/:key</code>. In case of <code>dropboxignore</code>:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>$ MANUAL_INSTALLATIONS<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>curl -s https://api.countapi.xyz/info/dropboxignore.simakis.me/total | jq -r .value<span style=color:#66d9ef>)</span>
$ echo $MANUAL_INSTALLATIONS
<span style=color:#ae81ff>12</span>
</code></pre></div><p>At the time of writing <code>dropboxignore</code> has been installed 12 times using the kickstart.</p>
<h3 id=snapcraft>Snapcraft<a hidden class=anchor aria-hidden=true href=#snapcraft>#</a></h3>
<p>Another common way to distribute your software is as a snap. Snapcraft provides a nice monitoring dashboard:</p>
<p><img loading=lazy src=/images/snapcraft-dashboard.jpg alt=Snapcraft-dashboard>
</p>
<p>But in our case, this is not enough, we have to extract the raw data programmatically. For this reason we are going to use <a href=https://snapcraft.io/snapcraft>Snapcraft</a> CLI and <a href=https://github.com/marketplace/actions/snapcraft-action>Snapcraft Action</a></p>
<p>To get snapcraft metrics, you have to export a credential file and to create a github secret using the content of the exported file:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>$ snapcraft login
$ snapcraft export-login exported
</code></pre></div><p>In order to get the current total number of active user, you have to use the <code>snapcraft metric</code> command:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>$ SNAP_INSTALLATIONS<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span> <span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span>  snapcraft metrics dropboxignore --name installed_base_by_channel <span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span>                                  --start <span style=color:#e6db74>&#34;</span><span style=color:#66d9ef>$(</span>date +<span style=color:#e6db74>&#34;%Y-%m-%d&#34;</span> --date<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;yesterday&#34;</span><span style=color:#66d9ef>)</span><span style=color:#e6db74>&#34;</span> <span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span>                                  --end <span style=color:#e6db74>&#34;</span><span style=color:#66d9ef>$(</span>date +<span style=color:#e6db74>&#34;%Y-%m-%d&#34;</span> --date<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;yesterday&#34;</span><span style=color:#66d9ef>)</span><span style=color:#e6db74>&#34;</span> <span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span>                                  --format<span style=color:#f92672>=</span>json <span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span>  | jq <span style=color:#e6db74>&#39;.series[].values[]&#39;</span> <span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span>  | awk <span style=color:#e6db74>&#39;{s+=$1} END {printf &#34;%.0f\n&#34;, s}&#39;</span> <span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span><span style=color:#66d9ef>)</span>
$ echo $SNAP_INSTALLATIONS
<span style=color:#ae81ff>118</span>
</code></pre></div><p>So, 118 users have installed <code>dropboxignore</code> using snap.</p>
<h2 id=summarize>Summarize<a hidden class=anchor aria-hidden=true href=#summarize>#</a></h2>
<p>The easy part is to summarize user from different sources:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>$ TOTAL_INSTALLATIONS<span style=color:#f92672>=</span><span style=color:#66d9ef>$((</span>MANUAL_INSTALLATIONS <span style=color:#f92672>+</span> SNAP_INSTALLATIONS<span style=color:#66d9ef>))</span>
$ echo $TOTAL_INSTALLATIONS
<span style=color:#ae81ff>130</span>
</code></pre></div><p>130 users. I&rsquo;m already boosted morally ü§£.</p>
<h2 id=automate-the-boring-staff-using-github-actions>Automate the boring staff using Github Actions<a hidden class=anchor aria-hidden=true href=#automate-the-boring-staff-using-github-actions>#</a></h2>
<p>Finally, given that we retrieved the necessary information programmatically, we are going to create a nightly job to store active users. The wiki of the repo should be enabled, so, we will use the wiki to store the statistics.</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>JSON_BADGE_STRING<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>cat <span style=color:#e6db74>&lt;&lt;-END
</span><span style=color:#e6db74>{&#34;schemaVersion&#34;: 1, &#34;label&#34;: &#34;installations&#34;, &#34;message&#34;: &#34;$TOTAL_INSTALLATIONS&#34;}
</span><span style=color:#e6db74>END</span>
<span style=color:#66d9ef>)</span>
JSON_FULL_STRING<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>cat <span style=color:#e6db74>&lt;&lt;-END
</span><span style=color:#e6db74>{&#34;manual-installations&#34;: &#34;$MANUAL_INSTALLATIONS&#34;, &#34;snap-installations&#34;: &#34;$SNAP_INSTALLATIONS&#34;, &#34;total-installations&#34;: &#34;$TOTAL_INSTALLATIONS&#34;}
</span><span style=color:#e6db74>END</span>
<span style=color:#66d9ef>)</span>
FILENAME<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span><span style=color:#66d9ef>$(</span>date +<span style=color:#e6db74>&#34;%Y-%m-%d&#34;</span> --date<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;yesterday&#34;</span><span style=color:#66d9ef>)</span><span style=color:#e6db74>-stats.json&#34;</span>
echo <span style=color:#e6db74>&#34;</span>$JSON_BADGE_STRING<span style=color:#e6db74>&#34;</span> &gt; latest-stats.json
echo <span style=color:#e6db74>&#34;</span>$JSON_FULL_STRING<span style=color:#e6db74>&#34;</span> &gt; <span style=color:#e6db74>&#34;</span>$FILENAME<span style=color:#e6db74>&#34;</span>

git add latest-stats.json
git add <span style=color:#e6db74>&#34;</span>$FILENAME<span style=color:#e6db74>&#34;</span>

<span style=color:#66d9ef>if</span> ! git diff --staged --exit-code
<span style=color:#66d9ef>then</span>
    git config --global user.email <span style=color:#e6db74>&#34;coverage-comment-action&#34;</span>
    git config --global user.name <span style=color:#e6db74>&#34;Coverage Comment Action&#34;</span>
    git commit -m <span style=color:#e6db74>&#34;</span><span style=color:#66d9ef>$(</span>date +<span style=color:#e6db74>&#34;%Y-%m-%d&#34;</span> --date<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;yesterday&#34;</span><span style=color:#66d9ef>)</span><span style=color:#e6db74> stats&#34;</span>

    git push -u origin
<span style=color:#66d9ef>else</span>
    echo <span style=color:#e6db74>&#34;No change detected, skipping.&#34;</span>
<span style=color:#66d9ef>fi</span>
</code></pre></div><h2 id=badges-everywhere>Badges everywhere<a hidden class=anchor aria-hidden=true href=#badges-everywhere>#</a></h2>
<p>There is always space for one more badge with the total number of <img loading=lazy src="https://img.shields.io/endpoint?url=https%3A%2F%2Fraw.githubusercontent.com%2Fwiki%2Fsp1thas%2Fdropboxignore%2Fstats.json" alt=installations-badge>
</p>
<p><img loading=lazy src=/images/installations-badge.jpg alt=Badges>
</p>
<h2 id=cronjob-using-github-actions>Cronjob using Github Actions<a hidden class=anchor aria-hidden=true href=#cronjob-using-github-actions>#</a></h2>
<p>The number of active users is updated every night using the following job:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>name: Nightly stats

on:
  schedule:
    - cron: <span style=color:#e6db74>&#34;1 1 * * *&#34;</span>
  workflow_dispatch:

jobs:
  stats:
    runs-on: ubuntu-latest

    steps:
      - name: Install Snapcraft
        uses: samuelmeuli/action-snapcraft@v1
        with:
          snapcraft_token: <span style=color:#e6db74>${</span>{ secrets.SNAPCRAFT_LOGIN_FILE <span style=color:#e6db74>}</span><span style=color:#f92672>}</span>
      - name: Install os dependencies
        run: sudo apt update <span style=color:#f92672>&amp;&amp;</span> sudo apt install curl jq git
      
      - name: Create stats file
        run: sh -c <span style=color:#e6db74>&#34;</span><span style=color:#66d9ef>$(</span>curl -fsSL https://raw.githubusercontent.com/sp1thas/dropboxignore/master/utils/stats.sh<span style=color:#66d9ef>)</span><span style=color:#e6db74>&#34;</span> <span style=color:#e6db74>&#39;${{ secrets.GITHUB_TOKEN }}&#39;</span>
</code></pre></div><h2 id=next-steps>Next steps<a hidden class=anchor aria-hidden=true href=#next-steps>#</a></h2>
<ul>
<li>Count manual uninstalls.</li>
<li>Count flatpak installations.</li>
</ul>
<h2 id=references>References<a hidden class=anchor aria-hidden=true href=#references>#</a></h2>
<ul>
<li><a href=https://github.com/sp1thas/dropboxignore.git>sp1thas/dropboxignore</a></li>
<li><a href=https://github.com/sp1thas/dropboxignore/blob/master/utils/stats.sh><code>dropboxignore/utils/stats.sh</code></a></li>
<li><a href=https://github.com/sp1thas/dropboxignore/blob/master/.github/workflows/stats.yml><code>dropboxignore/.github/workflows/stats.yml</code></a></li>
<li><a href=https://github.com/marketplace/actions/snapcraft-action>Snapcraft Action</a></li>
<li><a href=https://snapcraft.io/>Snapcraft</a></li>
<li><a href=https://countapi.xyz/>CountAPI</a></li>
</ul>
</div>
<footer class=post-footer>
<ul class=post-tags>
<li><a href=https://simakis.me/tags/oss/>oss</a></li>
<li><a href=https://simakis.me/tags/github-actions/>github-actions</a></li>
<li><a href=https://simakis.me/tags/snapcraft/>snapcraft</a></li>
<li><a href=https://simakis.me/tags/flatpak/>flatpak</a></li>
</ul>
<nav class=paginav>
<a class=next href=https://simakis.me/posts/sphinx-prefect/>
<span class=title>Next Page ¬ª</span>
<br>
<span>Add prefect flow visualizations into a Sphinx project</span>
</a>
</nav>
<div class=share-buttons>
<a target=_blank rel="noopener noreferrer" aria-label="share OSS: Estimate and monitor the number of active users using Github Actions on twitter" href="https://twitter.com/intent/tweet/?text=OSS%3a%20Estimate%20and%20monitor%20the%20number%20of%20active%20users%20using%20Github%20Actions&url=https%3a%2f%2fsimakis.me%2fposts%2foss-user-counting%2f&hashtags=oss%2cgithub-actions%2csnapcraft%2cflatpak"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM195.519 424.544c135.939.0 210.268-112.643 210.268-210.268.0-3.218.0-6.437-.153-9.502 14.406-10.421 26.973-23.448 36.935-38.314-13.18 5.824-27.433 9.809-42.452 11.648 15.326-9.196 26.973-23.602 32.49-40.92-14.252 8.429-30.038 14.56-46.896 17.931-13.487-14.406-32.644-23.295-53.946-23.295-40.767.0-73.87 33.104-73.87 73.87.0 5.824.613 11.494 1.992 16.858-61.456-3.065-115.862-32.49-152.337-77.241-6.284 10.881-9.962 23.601-9.962 37.088.0 25.594 13.027 48.276 32.95 61.456-12.107-.307-23.448-3.678-33.41-9.196v.92c0 35.862 25.441 65.594 59.311 72.49-6.13 1.686-12.72 2.606-19.464 2.606-4.751.0-9.348-.46-13.946-1.38 9.349 29.426 36.628 50.728 68.965 51.341-25.287 19.771-57.164 31.571-91.8 31.571-5.977.0-11.801-.306-17.625-1.073 32.337 21.15 71.264 33.41 112.95 33.41z"/></svg>
</a>
<a target=_blank rel="noopener noreferrer" aria-label="share OSS: Estimate and monitor the number of active users using Github Actions on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2fsimakis.me%2fposts%2foss-user-counting%2f&title=OSS%3a%20Estimate%20and%20monitor%20the%20number%20of%20active%20users%20using%20Github%20Actions&summary=OSS%3a%20Estimate%20and%20monitor%20the%20number%20of%20active%20users%20using%20Github%20Actions&source=https%3a%2f%2fsimakis.me%2fposts%2foss-user-counting%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg>
</a>
<a target=_blank rel="noopener noreferrer" aria-label="share OSS: Estimate and monitor the number of active users using Github Actions on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fsimakis.me%2fposts%2foss-user-counting%2f&title=OSS%3a%20Estimate%20and%20monitor%20the%20number%20of%20active%20users%20using%20Github%20Actions"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg>
</a>
<a target=_blank rel="noopener noreferrer" aria-label="share OSS: Estimate and monitor the number of active users using Github Actions on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fsimakis.me%2fposts%2foss-user-counting%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg>
</a>
</div>
</footer><div id=disqus_thread></div>
<script type=application/javascript>var disqus_config=function(){};(function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById('disqus_thread').innerHTML='Disqus comments not available by default when the website is previewed locally.';return}var b=document,a=b.createElement('script');a.async=!0,a.src='//simakis-me.disqus.com/embed.js',a.setAttribute('data-timestamp',+new Date),(b.head||b.body).appendChild(a)})()</script>
<noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript>
<a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a>
</article>
</main>
<footer class=footer>
<span>&copy; 2022 <a href=https://simakis.me/>Panagiotis Simakis</a></span>
<span>
Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://git.io/hugopapermod rel=noopener target=_blank>PaperMod</a>
</span>
</footer>
<a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a>
<script>let menu=document.getElementById('menu');menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(a=>{a.addEventListener("click",function(b){b.preventDefault();var a=this.getAttribute("href").substr(1);window.matchMedia('(prefers-reduced-motion: reduce)').matches?document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView({behavior:"smooth"}),a==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${a}`)})})</script>
<script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script>
<script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove('dark'),localStorage.setItem("pref-theme",'light')):(document.body.classList.add('dark'),localStorage.setItem("pref-theme",'dark'))})</script>
<script>document.querySelectorAll('pre > code').forEach(b=>{const c=b.parentNode.parentNode,a=document.createElement('button');a.classList.add('copy-code'),a.innerText='copy';function d(){a.innerText='copied!',setTimeout(()=>{a.innerText='copy'},2e3)}a.addEventListener('click',e=>{if('clipboard'in navigator){navigator.clipboard.writeText(b.textContent),d();return}const a=document.createRange();a.selectNodeContents(b);const c=window.getSelection();c.removeAllRanges(),c.addRange(a);try{document.execCommand('copy'),d()}catch(a){}c.removeRange(a)}),c.classList.contains("highlight")?c.appendChild(a):c.parentNode.firstChild==c||(b.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?b.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(a):b.parentNode.appendChild(a))})</script>
</body>
</html>