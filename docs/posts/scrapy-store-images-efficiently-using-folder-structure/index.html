<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Store images efficiently in scrapy using folder structure | Panagiotis Simakis</title><meta name=keywords content="scrapy,python,items,pipelines,image storing,scrapy images,folder structure"><meta name=description content="How to employ folder structure as an efficient and easy way to store large number of images using scrapy pipelines"><meta name=author content="Panagiotis Simakis"><link rel=canonical href=https://simakis.me/posts/scrapy-store-images-efficiently-using-folder-structure/><link crossorigin=anonymous href=/assets/css/stylesheet.f31506494d50c1e73c10e63d252a2d8a2cb329e28c1402c71fee0d3145ad3685.css integrity="sha256-8xUGSU1Qwec8EOY9JSotiiyzKeKMFALHH+4NMUWtNoU=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad();></script><link rel=icon href=https://simakis.me/favicons/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://simakis.me/favicons/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://simakis.me/favicons/favicon-32x32.png><link rel=apple-touch-icon href=https://simakis.me/favicons/apple-touch-icon.png><link rel=mask-icon href=https://simakis.me/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme: rgb(29, 30, 32);--entry: rgb(46, 46, 51);--primary: rgb(218, 218, 219);--secondary: rgb(155, 156, 157);--tertiary: rgb(65, 66, 68);--content: rgb(196, 196, 197);--hljs-bg: rgb(46, 46, 51);--code-bg: rgb(55, 56, 62);--border: rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script async defer data-website-id=6b836b1b-f562-47d0-a681-7a36d59c761b src=https://analytics.simakis.me/umami.js></script><script>MathJax={tex:{inlineMath:[['$','$'],['\\(','\\)']],displayMath:[['$$','$$'],['\\[','\\]']],processEscapes:true,processEnvironments:true},options:{skipHtmlTags:['script','noscript','style','textarea','pre']}};window.addEventListener('load',(event)=>{document.querySelectorAll("mjx-container").forEach(function(x){x.parentElement.classList+='has-jax'})});</script><script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script><script type=text/javascript id=MathJax-script async src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><link rel=stylesheet href=https://simakis.me/custom.css><meta property="og:title" content="Store images efficiently in scrapy using folder structure"><meta property="og:description" content="How to employ folder structure as an efficient and easy way to store large number of images using scrapy pipelines"><meta property="og:type" content="article"><meta property="og:url" content="https://simakis.me/posts/scrapy-store-images-efficiently-using-folder-structure/"><meta property="og:image" content="https://simakis.me/images/post-covers/scrapy.jpg"><meta property="article:section" content="posts"><meta property="article:published_time" content="2020-08-06T15:24:09+02:00"><meta property="article:modified_time" content="2020-08-06T15:24:09+02:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://simakis.me/images/post-covers/scrapy.jpg"><meta name=twitter:title content="Store images efficiently in scrapy using folder structure"><meta name=twitter:description content="How to employ folder structure as an efficient and easy way to store large number of images using scrapy pipelines"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://simakis.me/posts/"},{"@type":"ListItem","position":2,"name":"Store images efficiently in scrapy using folder structure","item":"https://simakis.me/posts/scrapy-store-images-efficiently-using-folder-structure/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Store images efficiently in scrapy using folder structure","name":"Store images efficiently in scrapy using folder structure","description":"How to employ folder structure as an efficient and easy way to store large number of images using scrapy pipelines","keywords":["scrapy","python","items","pipelines","image storing","scrapy images","folder structure"],"articleBody":"Introduction NOTE: This article was the reason to implement the scrapy-folder-tree scrapy extension.\nWhat is the problem and how deal with it When it comes to image storing, a common pitfall is to save all the images in a single folder. If the number of images is less than few thousands, when, stop reading this post because you will not face any issue. On the other hand, if you are planing to store numerous images, then consider splitting them in different folders. Listing a directory will become faster, more efficient and at the end of the day, your kernel will be happier. A common pattern is to create a folder structure based on the name of every file. For example, let’s say that path/to/image/dir will be the main directory, and you want to store imagefile.jpg. Create folder structure based on file’s characters and save the file inside the leaf folder:\n$ tree path/to/image/dir path/to/image/dir └── i └── m └── a └── imagefile.jpg A testcase Given the following situation:\n Folder structure’s depth is 3 The maximum number of images per leaf folder is 1000 A common hashing function is used for naming ([a-z0-9])  The main folder can host up to:\n$$\\left ( \\left ( 26 + 10 \\right )^3 \\right ) * 1000 \\approx 46 \\text{ Milion images}$$\nApplication Time to get our hands dirty.\nDescription The purpose of this post is demonstrate an easy way to apply this methodology using scrapy and specifically the ImagePipeline. The default behavior of ImagePipeline is to store all images in the same folder based on IMAGES_STORE‘s value in settings.py. We are going to make an ImagePipeline sub-class and we will override file_path and thumb_path methods. Please find below the full pipeline:\nImplementation  ","wordCount":"288","inLanguage":"en","image":"https://simakis.me/images/post-covers/scrapy.jpg","datePublished":"2020-08-06T15:24:09+02:00","dateModified":"2020-08-06T15:24:09+02:00","author":{"@type":"Person","name":"Panagiotis Simakis"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://simakis.me/posts/scrapy-store-images-efficiently-using-folder-structure/"},"publisher":{"@type":"Organization","name":"Panagiotis Simakis","logo":{"@type":"ImageObject","url":"https://simakis.me/favicons/favicon.ico"}}}</script></head><body id=top><script>if(localStorage.getItem("pref-theme")==="dark"){document.body.classList.add('dark');}else if(localStorage.getItem("pref-theme")==="light"){document.body.classList.remove('dark')}else if(window.matchMedia('(prefers-color-scheme: dark)').matches){document.body.classList.add('dark');}</script><header class=header><nav class=nav><div class=logo><a href=https://simakis.me/ accesskey=h title="Panagiotis Simakis (Alt + H)">Panagiotis Simakis</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://simakis.me/posts title=Posts><span>Posts</span></a></li><li><a href=https://simakis.me/cv title=CV><span>CV</span></a></li><li><a href=https://simakis.me/contributions/ title=Contributions><span>Contributions</span></a></li><li><a href=https://simakis.me/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li><li><a href=https://simakis.me/contact/ title=Contact><span>Contact</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://simakis.me/>Home</a>&nbsp;»&nbsp;<a href=https://simakis.me/posts/>Posts</a></div><h1 class=post-title>Store images efficiently in scrapy using folder structure</h1><div class=post-description>How to employ folder structure as an efficient and easy way to store large number of images using scrapy pipelines</div><div class=post-meta><span title="2020-08-06 15:24:09 +0200 +0200">August 6, 2020</span>&nbsp;·&nbsp;2 min&nbsp;·&nbsp;Panagiotis Simakis</div></header><figure class=entry-cover><img loading=lazy src=https://simakis.me/images/post-covers/scrapy.jpg alt=scrapy-plugin-alt><p>Archive Shelfs at Sächsisches Staatsarchiv in Dresden, Saxony, Germany &ndash; <a href=https://unsplash.com/photos/X_j3b4rqnlk>C M</a></p></figure><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#introduction aria-label=Introduction>Introduction</a><ul><li><a href=#what-is-the-problem-and-how-deal-with-it aria-label="What is the problem and how deal with it">What is the problem and how deal with it</a></li><li><a href=#a-testcase aria-label="A testcase">A testcase</a></li></ul></li><li><a href=#application aria-label=Application>Application</a><ul><li><a href=#description aria-label=Description>Description</a></li><li><a href=#implementation aria-label=Implementation>Implementation</a></li></ul></li></ul></div></details></div><div class=post-content><h2 id=introduction>Introduction<a hidden class=anchor aria-hidden=true href=#introduction>#</a></h2><p><strong>NOTE</strong>: This article was the reason to implement the <code>scrapy-folder-tree</code> scrapy extension.</p><h3 id=what-is-the-problem-and-how-deal-with-it>What is the problem and how deal with it<a hidden class=anchor aria-hidden=true href=#what-is-the-problem-and-how-deal-with-it>#</a></h3><p>When it comes to image storing, a common pitfall is to save all the images in a single folder. If the number of images
is less than few thousands, when, stop reading this post because you will not face any issue. On the other hand, if you
are planing to store numerous images, then consider splitting them in different folders. Listing a directory will become
faster, more efficient and at the end of the day, your kernel will be happier. A common pattern is to create a folder
structure based on the name of every file. For example, let’s say that <code>path/to/image/dir</code> will be the main directory,
and you want to store <code>imagefile.jpg</code>. Create folder structure based on file’s characters and save the file inside the
leaf folder:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>$ tree path/to/image/dir
path/to/image/dir
└── i
    └── m
        └── a
            └── imagefile.jpg
</code></pre></div><h3 id=a-testcase>A testcase<a hidden class=anchor aria-hidden=true href=#a-testcase>#</a></h3><p>Given the following situation:</p><ul><li>Folder structure’s depth is 3</li><li>The maximum number of images per leaf folder is 1000</li><li>A common hashing function is used for naming (<code>[a-z0-9]</code>)</li></ul><p>The main folder can host up to:</p><p>$$\left ( \left ( 26 + 10 \right )^3 \right ) * 1000 \approx 46 \text{ Milion images}$$</p><h2 id=application>Application<a hidden class=anchor aria-hidden=true href=#application>#</a></h2><p>Time to get our hands dirty.</p><h3 id=description>Description<a hidden class=anchor aria-hidden=true href=#description>#</a></h3><p>The purpose of this post is demonstrate an easy way to apply this methodology using <a href=https://scrapy.org/><code>scrapy</code></a> and
specifically
the <a href=https://docs.scrapy.org/en/latest/topics/media-pipeline.html#using-the-images-pipeline><code>ImagePipeline</code></a>. The
default behavior of <code>ImagePipeline</code> is to store all images in the same folder based
on <a href=https://docs.scrapy.org/en/latest/topics/media-pipeline.html#std-setting-IMAGES_STORE><code>IMAGES_STORE</code></a>‘s value
in <a href=https://docs.scrapy.org/en/latest/topics/settings.html#project-settings-module><code>settings.py</code></a>. We are going to make
an <code>ImagePipeline</code> sub-class and we will
override <a href=https://docs.scrapy.org/en/latest/topics/media-pipeline.html#scrapy.pipelines.images.ImagesPipeline.file_path><code>file_path</code></a>
and <code>thumb_path</code> methods. Please find below the full pipeline:</p><h3 id=implementation>Implementation<a hidden class=anchor aria-hidden=true href=#implementation>#</a></h3><script type=application/javascript src=https://gist.github.com/sp1thas/8a05a4e2710b82e9d8e57d6153a7dd1f.js></script></div><footer class=post-footer><ul class=post-tags><li><a href=https://simakis.me/tags/scrapy/>scrapy</a></li><li><a href=https://simakis.me/tags/python/>python</a></li></ul><nav class=paginav><a class=prev href=https://simakis.me/posts/exclude-files-using-dropboxignore/><span class=title>« Prev</span><br><span>Exclude files from your dropbox easily using dropboxignore</span></a>
<a class=next href=https://simakis.me/posts/semi-supervised-fraud-detection/><span class=title>Next »</span><br><span>Semi-Supervised Fraud Detection</span></a></nav><div class=share-buttons><a target=_blank rel="noopener noreferrer" aria-label="share Store images efficiently in scrapy using folder structure on twitter" href="https://twitter.com/intent/tweet/?text=Store%20images%20efficiently%20in%20scrapy%20using%20folder%20structure&url=https%3a%2f%2fsimakis.me%2fposts%2fscrapy-store-images-efficiently-using-folder-structure%2f&hashtags=scrapy%2cpython"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512h-386.892c-34.524.0-62.554-28.03-62.554-62.554v-386.892c0-34.524 28.029-62.554 62.554-62.554h386.892zm-253.927 424.544c135.939.0 210.268-112.643 210.268-210.268.0-3.218.0-6.437-.153-9.502 14.406-10.421 26.973-23.448 36.935-38.314-13.18 5.824-27.433 9.809-42.452 11.648 15.326-9.196 26.973-23.602 32.49-40.92-14.252 8.429-30.038 14.56-46.896 17.931-13.487-14.406-32.644-23.295-53.946-23.295-40.767.0-73.87 33.104-73.87 73.87.0 5.824.613 11.494 1.992 16.858-61.456-3.065-115.862-32.49-152.337-77.241-6.284 10.881-9.962 23.601-9.962 37.088.0 25.594 13.027 48.276 32.95 61.456-12.107-.307-23.448-3.678-33.41-9.196v.92c0 35.862 25.441 65.594 59.311 72.49-6.13 1.686-12.72 2.606-19.464 2.606-4.751.0-9.348-.46-13.946-1.38 9.349 29.426 36.628 50.728 68.965 51.341-25.287 19.771-57.164 31.571-91.8 31.571-5.977.0-11.801-.306-17.625-1.073 32.337 21.15 71.264 33.41 112.95 33.41z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Store images efficiently in scrapy using folder structure on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2fsimakis.me%2fposts%2fscrapy-store-images-efficiently-using-folder-structure%2f&title=Store%20images%20efficiently%20in%20scrapy%20using%20folder%20structure&summary=Store%20images%20efficiently%20in%20scrapy%20using%20folder%20structure&source=https%3a%2f%2fsimakis.me%2fposts%2fscrapy-store-images-efficiently-using-folder-structure%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512h-386.892c-34.524.0-62.554-28.03-62.554-62.554v-386.892c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0v-129.439c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02v-126.056c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768h75.024zm-307.552-334.556c-25.674.0-42.448 16.879-42.448 39.002.0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Store images efficiently in scrapy using folder structure on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fsimakis.me%2fposts%2fscrapy-store-images-efficiently-using-folder-structure%2f&title=Store%20images%20efficiently%20in%20scrapy%20using%20folder%20structure"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512h-386.892c-34.524.0-62.554-28.03-62.554-62.554v-386.892c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zm-119.474 108.193c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zm-160.386-29.702c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Store images efficiently in scrapy using folder structure on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fsimakis.me%2fposts%2fscrapy-store-images-efficiently-using-folder-structure%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978v-192.915h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554v-386.892c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a></div></footer><div id=disqus_thread></div><script type=application/javascript>var disqus_config=function(){};(function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById('disqus_thread').innerHTML='Disqus comments not available by default when the website is previewed locally.';return;}
var d=document,s=d.createElement('script');s.async=true;s.src='//'+"simakis-me"+'.disqus.com/embed.js';s.setAttribute('data-timestamp',+new Date());(d.head||d.body).appendChild(s);})();</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></article></main><footer class=footer><span>&copy; 2023 <a href=https://simakis.me/>Panagiotis Simakis</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById('menu')
if(menu){menu.scrollLeft=localStorage.getItem("menu-scroll-position");menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft);}}
document.querySelectorAll('a[href^="#"]').forEach(anchor=>{anchor.addEventListener("click",function(e){e.preventDefault();var id=this.getAttribute("href").substr(1);if(!window.matchMedia('(prefers-reduced-motion: reduce)').matches){document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({behavior:"smooth"});}else{document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();}
if(id==="top"){history.replaceState(null,null," ");}else{history.pushState(null,null,`#${id}`);}});});</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){if(document.body.scrollTop>800||document.documentElement.scrollTop>800){mybutton.style.visibility="visible";mybutton.style.opacity="1";}else{mybutton.style.visibility="hidden";mybutton.style.opacity="0";}};</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{if(document.body.className.includes("dark")){document.body.classList.remove('dark');localStorage.setItem("pref-theme",'light');}else{document.body.classList.add('dark');localStorage.setItem("pref-theme",'dark');}})</script><script>document.querySelectorAll('pre > code').forEach((codeblock)=>{const container=codeblock.parentNode.parentNode;const copybutton=document.createElement('button');copybutton.classList.add('copy-code');copybutton.innerHTML='copy';function copyingDone(){copybutton.innerHTML='copied!';setTimeout(()=>{copybutton.innerHTML='copy';},2000);}
copybutton.addEventListener('click',(cb)=>{if('clipboard'in navigator){navigator.clipboard.writeText(codeblock.textContent);copyingDone();return;}
const range=document.createRange();range.selectNodeContents(codeblock);const selection=window.getSelection();selection.removeAllRanges();selection.addRange(range);try{document.execCommand('copy');copyingDone();}catch(e){};selection.removeRange(range);});if(container.classList.contains("highlight")){container.appendChild(copybutton);}else if(container.parentNode.firstChild==container){}else if(codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"){codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);}else{codeblock.parentNode.appendChild(copybutton);}});</script></body></html>