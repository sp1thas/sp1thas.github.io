<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="author" content="Panagiotis Simakis">
  <meta name="description" content="Store images efficiently in scrapy using folder structure | How to employ folder structure as an efficient and easy way to store large number of images...">

  <link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16">
  <link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32">  
  <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96">
  
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.6/css/bootstrap.min.css" type="text/css" media="all">
  <link rel="stylesheet" href="/theme/css/font.css" type="text/css" media="all">
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  <link rel="stylesheet" href="/theme/css/style.css" type="text/css" media="all">

  <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/jquery/1.12.3/jquery.min.js"></script>
  <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/modernizr/2.8.3/modernizr.min.js"></script>
  <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.6/js/bootstrap.min.js"></script>
  <script type="text/javascript" src="/theme/js/functions.js"></script>

  
 

  <link href="/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Panagiotis Simakis - Personal Website Full Atom Feed" />

<meta name="keywords" content="keywords, python">



  <title>Store images efficiently in scrapy using folder structure</title>

  
</head>

<body class="home blog">
  <div>
    <header class="site-header">
      <nav class="navbar navbar-default" role="navigation">
        <div class="container">
          <div class="row">
            <div class="site-navigation-inner col-sm-12">
              <div class="navbar-header">
                <button type="button" class="btn navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
                  <span class="sr-only">Toggle navigation</span>
                  <span class="icon-bar"></span>
                  <span class="icon-bar"></span>
                  <span class="icon-bar"></span>
                </button>
              </div>
              <div class="collapse navbar-collapse navbar-ex1-collapse">
              <ul id="menu-all-pages" class="nav navbar-nav">
                <li class="menu-item"><a href="/" >Home
<i class="fa  fa-lg"></i></a></li>
                <li class="menu-item"><a href="/pages/resume" >Resume
<i class="fa  fa-lg"></i></a></li>
              </ul>
              </div>
              <div class="social">   
                <a href="https://github.com/sp1thas" title="GitHub" >
<i class="fa fa-github fa-lg"></i></a>
                <a href="https://twitter.com/sp1thas" title="Twitter" >
<i class="fa fa-twitter fa-lg"></i></a>
                <a href="https://www.linkedin.com/in/psimakis/" title="Linkedin" >
<i class="fa fa-linkedin fa-lg"></i></a>
                <a href="https://stackoverflow.com/users/6779252/panagiotis-simakis" title="Stackoverflow" >
<i class="fa fa-stack-overflow fa-lg"></i></a>
              </div>
            </div>
          </div>
        </div>
      </nav><!-- .site-navigation -->

      <div class="container">
      <div id="logo">
        <span class="site-name"><a class="navbar-brand" href=""><img width="310" src="/images/home.png" class="attachment-full size-full" alt="logo">          </a>
        </span><!-- end of .site-name -->
      </div><!-- end of #logo -->
        <div class="tagline">
                <a href="/tag/dataset.html" >dataset (2)</a> &#124; 
                <a href="/tag/deep-learning.html" >deep learning (1)</a> &#124; 
                <a href="/tag/machine-learning.html" >machine learning (3)</a> &#124; 
                <a href="/tag/nlp.html" >nlp (2)</a> &#124; 
                <a href="/tag/python.html" >python (7)</a> &#124; 
                <a href="/archives" >Archives (8)</a>
        </div>
    </div>

  </header><!-- #masthead -->
  </div>
    <div id="content" class="site-content">
      <div class="container main-content-area">
        <div class="row">
          <div class="main-content-inner col-sm-12 col-md-12">
            <div id="primary" class="content-area">
              <div id="main" class="site-main" role="main">
                <div class="article-container">
<article>
  <div class="blog-item-wrap">
    <div class="post-inner-content">
      <header class="entry-header page-header">
        <span class="cat-item"><time datetime="2020-07-06 18:40:00+03:00">Ιουλ 06, 2020</time></span>
        <h1 class="entry-title"><a href="/articles/scrapy-store-images-efficiently-using-folder-structure">Store images efficiently in scrapy using folder structure</a></h1>
      </header><!-- .entry-header -->
      <div class="fb-like" data-href="/articles/scrapy-store-images-efficiently-using-folder-structure" data-layout="standard" data-action="like" data-show-faces="false" data-share="true"></div>
      <div class="entry-content">
        <p>How to employ folder structure as an efficient and easy way to store large number of images using scrapy pipelines.</p>
<h2>Introduction</h2>
<p>When it comes to image storing, a common pitfall is to save all the images in a single folder. If the number of images is less than few thousands, when, stop reading this post because you will not face any issue. On the other hand, if you are planing to store a large number of images, then consider to split them in different folders. Listing a directory will become faster, more efficient and at the end of the day, your kernel will be happier. A common pattern is to create a folder structure based on name of every file. For example, let’s say that <code>path/to/image/dir</code> will be the main directory and you want to store <code>imagefile.jpg</code>. Create folder structure based on file’s characters and save the file inside the leaf folder:</p>
<div class="highlight"><pre><span></span>$ tree path/to/image/dir
path/to/image/dir
└── i
    └── m
        └── a
            └── imagefile.jpg
</pre></div>


<p>Given the following situation:</p>
<ul>
<li>Folder structure’s depth is 3</li>
<li>The maximum number of images per leaf folder is 1000</li>
<li>A common hashing function is used for naming (<code>[a-z0-9]</code>)</li>
</ul>
<p>The main folder can host up to:</p>
<p><img alt="formula" src="https://latex.codecogs.com/png.latex?%28%2826%20+%2010%29%20%5E%203%29%20*%201000%20%5Capprox%2046M%20images"></p>
<p>Get your hands dirty</p>
<p>The purpose of this post is demonstrate an easy way to apply this methodology using <code>scrapy</code> and specificaly the <code>ImagePipeline</code>. The default behavior of <code>ImagePipeline</code> is to store all images in the same folder based on <code>IMAGES_STORE</code>‘s value in <code>settings.py</code>. We are going to make an <code>ImagePipeline</code> sub-class and we will override <code>file_path</code> and <code>thumb_path</code> methods. Please find below the full pipeline:</p>
<script src="https://gist.github.com/sp1thas/8a05a4e2710b82e9d8e57d6153a7dd1f.js"></script>

<p>Feel free to provide any feedback or comment and of course employ this pipeline to your project if you found it useful.</p>
<p>This methodology has been used in the <a href="https://github.com/sp1thas/book-depository-dataset">source code</a> of <a href="https://simakis.me/book-depository-dataset/">Book Depository Dataset</a>.</p>
      </div><!-- .entry-content -->
      <br /><br />
      <div class="article_meta">
        Tags:
          <a href="/tag/python.html">python</a>      </div>
    </div>
  </div>
</article><!-- #post-## -->
                </div>
              </div><!-- #main -->
          </div><!-- #primary -->
        </div>
      </div><!-- close .row -->
    </div><!-- close .container -->
  </div><!-- close .site-content -->




  <div id="footer-area">
    <footer id="colophon" class="site-footer" role="contentinfo">
      <div class="site-info container">
        <div class="row">
                    <div class="copyright col-md-12">
                    <a href="/pages/privacy-policy">Privacy Policy</a> | 
                    <a href="/pages/terms-and-conditions">Terms & Conditions</a><br />
                    This site uses the <a href="https://github.com/limbenjamin/voce">voce</a> theme by <a href="//limbenjamin.com/">Benjamin Lim</a><br />
                    &copy; 2020 <a href="">Panagiotis Simakis</a> </div>
        </div>
      </div><!-- .site-info -->
      <div class="scroll-to-top" style="display: none;"><i class="fa fa-angle-up"></i></div><!-- .scroll-to-top -->
    </footer><!-- #colophon -->
  </div>

  <script type="text/javascript">
    window.addEventListener('load', function(){
    if (window.location.pathname != '/' && window.location.pathname != '/index.html'){
      window.scroll(0, document.getElementById('main').offsetTop);
    }})
  </script>




</body>
</html>