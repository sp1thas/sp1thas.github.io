<!DOCTYPE html>
<html lang="en-us">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title> Store images efficiently in scrapy using folder structure | Panagiotis Simakis</title>
  <meta name="description" content="Hi there ðŸ‘‹ and welcome to my personal website. I&#39;m a Software Engineer, passionate with NLP and GNU/Linux addict. ">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="robots" content="all,follow">
  <meta name="googlebot" content="index,follow,snippet,archive">
  <meta property="og:title" content="Store images efficiently in scrapy using folder structure" />
<meta property="og:description" content="How to employ folder structure as an efficient and easy way to store large number of images using scrapy pipelines" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://simakis.me/posts/scrapy-store-images-efficiently-using-folder-structure/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2020-08-06T15:24:09+02:00" />
<meta property="article:modified_time" content="2020-08-06T15:24:09+02:00" />


  <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Store images efficiently in scrapy using folder structure"/>
<meta name="twitter:description" content="How to employ folder structure as an efficient and easy way to store large number of images using scrapy pipelines"/>

  
  
    
  
  
  <link rel="stylesheet" href="https://simakis.me/css/style-white.css">
  
  <script async defer data-website-id="d3dca747-95bb-4c9c-9c65-426a1822e786" src="https://stats.simakis.me/umami.js"></script>
  
  
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
  

  
<link rel="icon" type="image/png" href="https://simakis.me/images/favicon.ico" />

  
  
  
  
</head>

<body class="max-width mx-auto px3 ltr">
  <div class="content index py4">

  <div id="header-post">
  <a id="menu-icon" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fas fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
         
        <li><a href="/">Home</a></li>
         
        <li><a href="/posts">Writings</a></li>
         
        <li><a href="/cv">Curriculum Vitae</a></li>
         
        <li><a href="/contact">Contact</a></li>
         
        <li><a href="/contributions">Contributions</a></li>
        
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li>
          <a class="icon" href=" https://simakis.me/posts/semi-supervised-fraud-detection/">
            <i class="fas fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i>
          </a>
        </li>
        
        
        <li>
          <a class="icon" href="https://simakis.me/posts/dropboxignore/">
            <i class="fas fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i>
          </a>
        </li>
        
        <li>
          <a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');">
            <i class="fas fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i>
          </a>
        </li>
        <li>
          <a class="icon" href="#">
            <i class="fas fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i>
          </a>
        </li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      
      <ul>
  
  
    
  
  
  <li>
    <a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2fsimakis.me%2fposts%2fscrapy-store-images-efficiently-using-folder-structure%2f">
      <i class="fab fa-facebook " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://twitter.com/share?url=https%3a%2f%2fsimakis.me%2fposts%2fscrapy-store-images-efficiently-using-folder-structure%2f&text=Store%20images%20efficiently%20in%20scrapy%20using%20folder%20structure">
      <i class="fab fa-twitter " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2fsimakis.me%2fposts%2fscrapy-store-images-efficiently-using-folder-structure%2f&title=Store%20images%20efficiently%20in%20scrapy%20using%20folder%20structure">
      <i class="fab fa-linkedin " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2fsimakis.me%2fposts%2fscrapy-store-images-efficiently-using-folder-structure%2f&is_video=false&description=Store%20images%20efficiently%20in%20scrapy%20using%20folder%20structure">
      <i class="fab fa-pinterest " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="mailto:?subject=Store%20images%20efficiently%20in%20scrapy%20using%20folder%20structure&body=Check out this article: https%3a%2f%2fsimakis.me%2fposts%2fscrapy-store-images-efficiently-using-folder-structure%2f">
      <i class="fas fa-envelope " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2fsimakis.me%2fposts%2fscrapy-store-images-efficiently-using-folder-structure%2f&title=Store%20images%20efficiently%20in%20scrapy%20using%20folder%20structure">
      <i class="fab fa-get-pocket " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2fsimakis.me%2fposts%2fscrapy-store-images-efficiently-using-folder-structure%2f&title=Store%20images%20efficiently%20in%20scrapy%20using%20folder%20structure">
      <i class="fab fa-reddit " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="http://www.stumbleupon.com/submit?url=https%3a%2f%2fsimakis.me%2fposts%2fscrapy-store-images-efficiently-using-folder-structure%2f&title=Store%20images%20efficiently%20in%20scrapy%20using%20folder%20structure">
      <i class="fab fa-stumbleupon " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="http://digg.com/submit?url=https%3a%2f%2fsimakis.me%2fposts%2fscrapy-store-images-efficiently-using-folder-structure%2f&title=Store%20images%20efficiently%20in%20scrapy%20using%20folder%20structure">
      <i class="fab fa-digg " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="http://www.tumblr.com/share/link?url=https%3a%2f%2fsimakis.me%2fposts%2fscrapy-store-images-efficiently-using-folder-structure%2f&name=Store%20images%20efficiently%20in%20scrapy%20using%20folder%20structure&description=How%20to%20employ%20folder%20structure%20as%20an%20efficient%20and%20easy%20way%20to%20store%20large%20number%20of%20images%20using%20scrapy%20pipelines">
      <i class="fab fa-tumblr " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://news.ycombinator.com/submitlink?u=https%3a%2f%2fsimakis.me%2fposts%2fscrapy-store-images-efficiently-using-folder-structure%2f&t=Store%20images%20efficiently%20in%20scrapy%20using%20folder%20structure">
      <i class="fab fa-hacker-news " aria-hidden="true"></i>
    </a>
  </li>
</ul>

    </div>
    <div id="toc">
      <nav id="TableOfContents">
  <ul>
    <li><a href="#introduction">Introduction</a>
      <ul>
        <li><a href="#what-is-the-problem-and-how-deal-with-it">What is the problem and how deal with it</a></li>
        <li><a href="#a-testcase">A testcase</a></li>
      </ul>
    </li>
    <li><a href="#application">Application</a>
      <ul>
        <li><a href="#description">Description</a></li>
        <li><a href="#implementation">Implementation</a></li>
      </ul>
    </li>
  </ul>
</nav>
    </div>
  </span>
</div>


  <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
    <header>
      <h1 class="posttitle" itemprop="name headline">
        Store images efficiently in scrapy using folder structure
      </h1>
      <div class="meta">
        
        <div class="postdate">
          
          <time datetime="2020-08-06 15:24:09 &#43;0200 &#43;0200" itemprop="datePublished">2020-08-06</time>
          
        </div>
        
        
        <div class="article-tag">
            <i class="fas fa-tag"></i>
            
            
            <a class="tag-link" href="/tags/scrapy" rel="tag">scrapy</a>
            
             ,  
            <a class="tag-link" href="/tags/python" rel="tag">python</a>
            
        </div>
        
      </div>
    </header>

  
    <div class="content" itemprop="articleBody">
      <h2 id="introduction">Introduction</h2>
<h3 id="what-is-the-problem-and-how-deal-with-it">What is the problem and how deal with it</h3>
<p>When it comes to image storing, a common pitfall is to save all the images in a single folder. If the number of images is less than few thousands, when, stop reading this post because you will not face any issue. On the other hand, if you are planing to store numerous images, then consider splitting them in different folders. Listing a directory will become faster, more efficient and at the end of the day, your kernel will be happier. A common pattern is to create a folder structure based on the name of every file. For example, letâ€™s say that <code>path/to/image/dir</code> will be the main directory, and you want to store <code>imagefile.jpg</code>. Create folder structure based on fileâ€™s characters and save the file inside the leaf folder:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">$ tree path/to/image/dir
path/to/image/dir
â””â”€â”€ i
    â””â”€â”€ m
        â””â”€â”€ a
            â””â”€â”€ imagefile.jpg
</code></pre></div><h3 id="a-testcase">A testcase</h3>
<p>Given the following situation:</p>
<ul>
<li>Folder structureâ€™s depth is 3</li>
<li>The maximum number of images per leaf folder is 1000</li>
<li>A common hashing function is used for naming (<code>[a-z0-9]</code>)</li>
</ul>
<p>The main folder can host up to:</p>
<p>$$\left ( \left ( 26 + 10 \right )^3 \right ) * 1000 \approx 46 \text{ Milion images}$$</p>
<h2 id="application">Application</h2>
<p>Time to get our hands dirty.</p>
<h3 id="description">Description</h3>
<p>The purpose of this post is demonstrate an easy way to apply this methodology using <a href="https://scrapy.org/"><code>scrapy</code></a> and specifically the <a href="https://docs.scrapy.org/en/latest/topics/media-pipeline.html#using-the-images-pipeline"><code>ImagePipeline</code></a>. The default behavior of <code>ImagePipeline</code> is to store all images in the same folder based on <a href="https://docs.scrapy.org/en/latest/topics/media-pipeline.html#std-setting-IMAGES_STORE"><code>IMAGES_STORE</code></a>â€˜s value in <a href="https://docs.scrapy.org/en/latest/topics/settings.html#project-settings-module"><code>settings.py</code></a>. We are going to make an <code>ImagePipeline</code> sub-class and we will override <a href="https://docs.scrapy.org/en/latest/topics/media-pipeline.html#scrapy.pipelines.images.ImagesPipeline.file_path"><code>file_path</code></a> and <code>thumb_path</code> methods. Please find below the full pipeline:</p>
<h3 id="implementation">Implementation</h3>
<script type="application/javascript" src="https://gist.github.com/sp1thas/8a05a4e2710b82e9d8e57d6153a7dd1f.js"></script>


    </div>
  </article>

  
  




  
    <div class="blog-post-comments">
        <div id="disqus_thread">
          <script type="text/javascript">
          
          (function() {
              
              
              
              
          
              var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
              var disqus_shortname = 'simakis-me';
              dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
              (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
          })();
          </script>
          <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
          <a href="https://disqus.com/" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
        </div>
    </div>

  


  <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/posts">Writings</a></li>
         
          <li><a href="/cv">Curriculum Vitae</a></li>
         
          <li><a href="/contact">Contact</a></li>
         
          <li><a href="/contributions">Contributions</a></li>
        
      </ul>
    </div>

    <div id="toc-footer" style="display: none">
      <nav id="TableOfContents">
  <ul>
    <li><a href="#introduction">Introduction</a>
      <ul>
        <li><a href="#what-is-the-problem-and-how-deal-with-it">What is the problem and how deal with it</a></li>
        <li><a href="#a-testcase">A testcase</a></li>
      </ul>
    </li>
    <li><a href="#application">Application</a>
      <ul>
        <li><a href="#description">Description</a></li>
        <li><a href="#implementation">Implementation</a></li>
      </ul>
    </li>
  </ul>
</nav>
    </div>

    <div id="share-footer" style="display: none">
      
      <ul>
  
  
    
  
  
  <li>
    <a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2fsimakis.me%2fposts%2fscrapy-store-images-efficiently-using-folder-structure%2f">
      <i class="fab fa-facebook fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://twitter.com/share?url=https%3a%2f%2fsimakis.me%2fposts%2fscrapy-store-images-efficiently-using-folder-structure%2f&text=Store%20images%20efficiently%20in%20scrapy%20using%20folder%20structure">
      <i class="fab fa-twitter fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2fsimakis.me%2fposts%2fscrapy-store-images-efficiently-using-folder-structure%2f&title=Store%20images%20efficiently%20in%20scrapy%20using%20folder%20structure">
      <i class="fab fa-linkedin fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2fsimakis.me%2fposts%2fscrapy-store-images-efficiently-using-folder-structure%2f&is_video=false&description=Store%20images%20efficiently%20in%20scrapy%20using%20folder%20structure">
      <i class="fab fa-pinterest fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="mailto:?subject=Store%20images%20efficiently%20in%20scrapy%20using%20folder%20structure&body=Check out this article: https%3a%2f%2fsimakis.me%2fposts%2fscrapy-store-images-efficiently-using-folder-structure%2f">
      <i class="fas fa-envelope fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2fsimakis.me%2fposts%2fscrapy-store-images-efficiently-using-folder-structure%2f&title=Store%20images%20efficiently%20in%20scrapy%20using%20folder%20structure">
      <i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2fsimakis.me%2fposts%2fscrapy-store-images-efficiently-using-folder-structure%2f&title=Store%20images%20efficiently%20in%20scrapy%20using%20folder%20structure">
      <i class="fab fa-reddit fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="http://www.stumbleupon.com/submit?url=https%3a%2f%2fsimakis.me%2fposts%2fscrapy-store-images-efficiently-using-folder-structure%2f&title=Store%20images%20efficiently%20in%20scrapy%20using%20folder%20structure">
      <i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="http://digg.com/submit?url=https%3a%2f%2fsimakis.me%2fposts%2fscrapy-store-images-efficiently-using-folder-structure%2f&title=Store%20images%20efficiently%20in%20scrapy%20using%20folder%20structure">
      <i class="fab fa-digg fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="http://www.tumblr.com/share/link?url=https%3a%2f%2fsimakis.me%2fposts%2fscrapy-store-images-efficiently-using-folder-structure%2f&name=Store%20images%20efficiently%20in%20scrapy%20using%20folder%20structure&description=How%20to%20employ%20folder%20structure%20as%20an%20efficient%20and%20easy%20way%20to%20store%20large%20number%20of%20images%20using%20scrapy%20pipelines">
      <i class="fab fa-tumblr fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://news.ycombinator.com/submitlink?u=https%3a%2f%2fsimakis.me%2fposts%2fscrapy-store-images-efficiently-using-folder-structure%2f&t=Store%20images%20efficiently%20in%20scrapy%20using%20folder%20structure">
      <i class="fab fa-hacker-news fa-lg" aria-hidden="true"></i>
    </a>
  </li>
</ul>

    </div>

    <div id="actions-footer">
      
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;">
          <i class="fas fa-bars fa-lg" aria-hidden="true"></i> Menu</a>
        <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;">
          <i class="fas fa-list fa-lg" aria-hidden="true"></i> TOC</a>
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;">
          <i class="fas fa-share-alt fa-lg" aria-hidden="true"></i> share</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');">
          <i class="fas fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a>
    </div>

  </div>
</div>


  <footer id="footer">
  <div class="footer-left">
    Copyright  &copy; 2021  Panagiotis Simakis 
  </div>
  <div class="footer-right">
    <nav>
      <ul>
         
        <li><a href="/">Home</a></li>
         
        <li><a href="/posts">Writings</a></li>
         
        <li><a href="/cv">Curriculum Vitae</a></li>
         
        <li><a href="/contact">Contact</a></li>
         
        <li><a href="/contributions">Contributions</a></li>
        
      </ul>
    </nav>
  </div>
</footer>


  </div>
</body>

<link rel="stylesheet" href=/lib/font-awesome/css/all.min.css>
<script src=/lib/jquery/jquery.min.js></script>
<script src=/js/main.js></script>


  


<script>
  MathJax = {
    tex: {
      inlineMath: [['$', '$'], ['\\(', '\\)']]
    },
    svg: {
      fontCache: 'global'
    }
  };
</script>
<script type="text/javascript" id="MathJax-script" async
  src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js">
</script>

</html>
